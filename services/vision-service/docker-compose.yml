version: '3.8'

services:
  vision-service:
    build: .
    container_name: agente-portero-vision
    ports:
      - "8001:8001"
    environment:
      - HIKVISION_HOST=${HIKVISION_HOST:-192.168.1.100}
      - HIKVISION_PORT=${HIKVISION_PORT:-80}
      - HIKVISION_USER=${HIKVISION_USER:-admin}
      - HIKVISION_PASSWORD=${HIKVISION_PASSWORD}
      - BACKEND_API_URL=${BACKEND_API_URL:-http://host.docker.internal:8000}
      - YOLO_MODEL=yolov8n.pt
      - YOLO_CONFIDENCE=0.5
      - OCR_LANGUAGE=es
      - DEBUG=${DEBUG:-false}
    volumes:
      - ./models:/app/models
    restart: unless-stopped
    # For GPU support, uncomment:
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

  # Optional: NVIDIA GPU version
  # vision-service-gpu:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.gpu
  #   runtime: nvidia
  #   ...
