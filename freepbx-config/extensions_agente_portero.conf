; =============================================================================
; Agente Portero - AudioSocket LOCAL (8kHz)
; =============================================================================
;
; INSTALLATION:
; 1. Copy this file to FreePBX: /etc/asterisk/extensions_agente_portero.conf
; 2. Reload dialplan: asterisk -rx "dialplan reload"
; 3. Test with softphone by dialing 1010
;
; IMPORTANT: voice-service Docker container must be running locally
; on FreePBX server with port 9089 exposed (host -> container 8089).
;
; NOTE: AudioSocket ALWAYS uses 8kHz signed linear PCM regardless of
; CHANNEL(audioreadformat) settings. The voice-service handles resampling.
;
; =============================================================================

[agente-portero-sitnova]
; Extension for AI security guard
; AudioSocket always uses 8kHz - voice-service resamples to/from OpenAI 24kHz

exten => 1010,1,NoOp(=== AGENTE PORTERO AI ===)
 same => n,Answer()
 same => n,Wait(0.5)
 same => n,Set(UUID=${SHELL(cat /proc/sys/kernel/random/uuid | tr -d '\n')})
 same => n,NoOp(UUID generado: ${UUID})
 same => n,AudioSocket(${UUID},127.0.0.1:9089)
 same => n,Hangup()

; =============================================================================
; Include in from-internal context
; =============================================================================

[from-internal-custom]
include => agente-portero-sitnova
